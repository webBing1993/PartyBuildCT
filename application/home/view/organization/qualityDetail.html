{extend name="public/common"}

{block name="style"}
<title>水质报表</title>
<link rel="stylesheet" href="/home/css/organization/qualityDetail.css">
<link rel="stylesheet" href="/static/sweetalert/sweetalert1.css">
<script src="/static/sweetalert/sweetalert1.min.js"></script>
{/block}

{block name="body"}
<div id="refreshContainer" class="mui-content mui-scroll-wrapper">
    <div class="mui-scroll">
        <div class="mui-slider-group">
            <div class="article">
                <div class="title"><p>水质检测报表</p></div>
                <div class="note clearfix"><span class="fr">2017年11月22日</span></div>
            </div>
            <div class="tableList">
                <table>
                    <tr>
                        <th></th>
                        <th>项目指标</th>
                        <th>单位</th>
                        <th>限值</th>
                        <th>检测结果</th>
                    </tr>
                    <tr>
                        <td rowspan="7">原水</td>
                        <tr>
                            <td>湿度</td>
                            <td>摄氏度</td>
                            <td></td>
                            <td>17.5</td>
                        </tr>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>19.3(上午8:30)</td>
                        </tr>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>18.8(上午10:00)</td>
                        </tr>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>18.8(下午14:00)</td>
                        </tr>
                        <tr>
                            <td>嗅和味</td>
                            <td></td>
                            <td>无异臭、无异味</td>
                            <td>无异臭、无异味</td>
                        </tr>
                        <tr>
                            <td>肉眼可见的</td>
                            <td></td>
                            <td>无</td>
                            <td>无</td>
                        </tr>
                    </tr>
                    <tr>
                        <td rowspan="4">沉后水</td>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>19.3(上午8:30)</td>
                        </tr>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>18.8(上午10:00)</td>
                        </tr>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>18.8(下午14:00)</td>
                        </tr>
                    </tr>
                    <tr>
                        <td rowspan="3">滤后水</td>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>19.3(上午8:30)</td>
                        </tr>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>18.8(下午14:00)</td>
                        </tr>
                    </tr>
                    <tr>
                        <td rowspan="5">出厂水</td>
                        <tr>
                            <td>浑浊度</td>
                            <td>NTU</td>
                            <td><10</td>
                            <td>19.3(上午8:30)</td>
                        </tr>
                        <tr>
                            <td>嗅和味</td>
                            <td></td>
                            <td>无异臭、无异味</td>
                            <td>无异臭、无异味</td>
                        </tr>
                        <tr>
                            <td>肉眼可见的</td>
                            <td></td>
                            <td>无</td>
                            <td>无</td>
                        </tr>
                        <tr>
                            <td>余氢</td>
                            <td>mgl</td>
                            <td><0.3/td>
                            <td>无0.49/td>
                        </tr>
                    </tr>
                </table>
            </div>
            <div class="conclusion">
                结论：
                <p>这里是结论的内容介绍这里是结论的内容介绍这里是结论的内容介绍这里是结论的内容介绍这里是结论的内容介绍</p>
                <div class="note">
                    <span class="fr">
                        <span class="read">100</span>
                        <span class="isgood good" onclick="isGood()">5</span>
                    </span>
                </div>
            </div>
            <div class="comment">
                <div class="sum">共<span>3</span>条评论</div>
                <div class="lists">
                    <!-- 评论区循环-->
                    <div class="list clear">
                        <div class="fl">
                            <img src="/home/images/common/party.png" alt="用户" class="user">
                        </div>
                        <div class="fl mid">
                            <div class="name limit">姓名</div>
                            <div class="content">评论内容</div>
                            <div class="time">2017-11-21</div>
                        </div>
                        <div class="fr isgood good" onclick="isGood()">2</div>
                    </div>
                    <!-- 评论区循环-->
                    <div class="list clear">
                        <div class="fl">
                            <img src="/home/images/common/party.png" alt="用户" class="user">
                        </div>
                        <div class="fl mid">
                            <div class="name limit">姓名</div>
                            <div class="content" >评论内容</div>
                            <div class="time">2017-11-21</div>
                        </div>
                        <div class="fr isgood good" onclick="isGood()">2</div>
                    </div>
                    <!-- 评论区循环-->
                    <div class="list clear">
                        <div class="fl">
                            <img src="/home/images/common/party.png" alt="用户" class="user">
                        </div>
                        <div class="fl mid">
                            <div class="name limit">姓名</div>
                            <div class="content" >评论内容</div>
                            <div class="time">2017-11-21</div>
                        </div>
                        <div class="fr isgood good" onclick="isGood()">2</div>
                    </div>
                    <!-- 评论区循环-->
                    <div class="list clear">
                        <div class="fl">
                            <img src="/home/images/common/party.png" alt="用户" class="user">
                        </div>
                        <div class="fl mid">
                            <div class="name limit">姓名</div>
                            <div class="content" >评论内容</div>
                            <div class="time">2017-11-21</div>
                        </div>
                        <div class="fr isgood good" onclick="isGood()">2</div>
                    </div>
                    <!-- 评论区循环-->
                    <div class="list clear">
                        <div class="fl">
                            <img src="/home/images/common/party.png" alt="用户" class="user">
                        </div>
                        <div class="fl mid">
                            <div class="name limit">姓名</div>
                            <div class="content" >评论内容</div>
                            <div class="time">2017-11-21</div>
                        </div>
                        <div class="fr isgood good" onclick="isGood()">2</div>
                    </div>
                    <!-- 评论区循环-->
                    <div class="list clear">
                        <div class="fl">
                            <img src="/home/images/common/party.png" alt="用户" class="user">
                        </div>
                        <div class="fl mid">
                            <div class="name limit">姓名</div>
                            <div class="content" >评论内容</div>
                            <div class="time">2017-11-21</div>
                        </div>
                        <div class="fr isgood good" onclick="isGood()">2</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 评论弹框-->
<div class="bottom clear" onclick="send()">
    <div class="myword fl">
        <input type="text" placeholder="说说你的感想！" disabled>
    </div>
</div>
{/block}
{block name="script"}
<script src="/home/js/reset.js"></script>
<script>

    $(function () {
        $("title").text("水质报表");
    });

    window.onload = function () {
        if ($(".lists .list").length < 6) {
            mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
        } else {
            mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
        }
    };
    mui.init({
        pullRefresh : {
            container: "#refreshContainer",
            up : {
                callback : loadScroll
            }
        }
    });
    function loadScroll() {
        var len = $(".lists .list").length;
        $.ajax({
            type: "post",
            url: "",
            data: {
                length: len
            },
            beforeSend: function(XMLHttpRequest){
            },
            success:function(data){
                addCourse(data);
                if(data.code == 1){
                    var dataLen =data.data.length;
                    if(data.data.length == 6){
                        mui('#refreshContainer').pullRefresh().endPullupToRefresh(false);
                    }else{
                        mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
                    }
                }else{
                    mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
                }
            }
        })
    }
    function addCourse(data) {
        var html = '';
        var lists = data.data;
        var len = lists.length;
        console.log(len);
        for(var i = 0; i< len;i++){
            var list = lists[i];
            html +=
                    '<div class="list clear">'+
                    '<div class="fl">'+
                    '<img src="'+data.header+'" alt="用户头像" class="user">'+
                    '</div>'+
                    '<div class="fl mid">'+
                    '<div class="name limit">'+data.nickname+'</div>'+
                    '<div class="content" >'+inputValue+'</div>'+
                    '<div class="time">'+data.time+'</div>'+
                    '</div>'+
                    '<div class="fr isgood good" onclick="isGood(this,0,'+data.id+')">'+data.likes+'</div>'+
                    '</div>';
        }
        $('.lists' ).prepend(html);
    }
    mui("#refreshContainer").on("touchstart","a",function(){
        $(this).css("backgroundColor","rgba(0,0,0,.1)");
    }).on("touchend","a", function () {
        $(this).css("backgroundColor","#fff");
    });
    mui("#refreshContainer").on("tap","a",function(){
        var url = this.getAttribute("href");
        window.location.href = url;
    });


    var scrollNow = true;//判断下拉请求是否执行中.false为正在请求

    /**
     * 点赞
     *
     */
    var isGood = function(e,type,id){
        //样式变化，移到suc
        var n = $(e ).text();
        $(e).toggleClass('good' ).toggleClass('good_');
        $(e ).hasClass('good')?n--:n++;
        $(e ).text(n);
        //type：1文章，2评论
//	var type = $(e ).hasClass('fr')?2:1;
        $.ajax({
            type:"post",
            url:"{:Url('Base/like')}",
            data:{
                type:type,
                aid:id,
            },
            success:function(data){

            }
        })
    };
    /**
     * 发送评论
     *
     */
    var send = function(e,type,id){
        swal({
                    title: '',
                    text: '请输入您的评论！',
                    type: 'input',
                    showCancelButton: true,
                    closeOnConfirm: false,
                    cancelButtonText: "取消",
                    confirmButtonText: "确定",
                    animation: "slider-form-top"

                },
                function(inputValue){
                    if (inputValue === false) return false;

                    if (inputValue.length < 1) {
                        swal.showInputError("评论字数不能少于1个字！");
                        return false
                    }

                    if (inputValue.length > 300) {
                        swal.showInputError("您输入的字超过了300！");
                        return false
                    }
                    $.ajax({
                        type:"post",
                        url:"{:Url('Base/comment')}",
                        data:{
                            type:type,
                            aid:id,
                            content:inputValue
                        },
                        beforeSend:function(){
                            swal({
                                title: ' ',
                                text: '评论提交中...',
                                showConfirmButton:false
                            });
                        },
                        success:function(data){
                            var data = data.data;
                            var userid = "'"+data.create_user+"'";
                            var html = '';
                            html += '<div class="list clear">'+
                                    '<div class="fl">'+
                                    '<img src="'+data.header+'" alt="用户头像" class="user">'+
                                    '</div>'+
                                    '<div class="fl mid">'+
                                    '<div class="name limit">'+data.nickname+'</div>'+
                                    '<div class="content" >'+inputValue+'</div>'+
                                    '<div class="time">'+data.time+'</div>'+
                                    '</div>'+
                                    '<div class="fr isgood good" onclick="isGood(this,0,'+data.id+')">'+data.likes+'</div>'+
                                    '</div>';
                            $('.lists' ).prepend(html);
                            inputValue="";
                            var sum = $('.sum span' );
                            sum.text(parseInt(sum.text())+1);
                            swal({
                                title: ' ',
                                text: '评论成功',
                                type: 'success',
                                confirmButtonText:'确定',
                                timer:3000
                            });
                        }
                    });
                }
        );
    };
</script>
{/block}