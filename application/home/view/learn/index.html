{extend name="public/common"}

{block name="style"}
<link rel="stylesheet" href="/home/css/learn/index.css">
{/block}

{block name="body"}
<div id="tab1" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
    <a class="mui-control-item" href="javascript:;" data-index="0">
        <span>手机党校</span>
    </a>
    <a class="mui-control-item" href="javascript:;" data-index="1">
        <span>练练身手</span>
    </a>
    <a class="mui-control-item" href="javascript:;" data-index="2">
        <span>党员先锋</span>
    </a>
</div>
<div class="mui-slider-group">
    <div id="refreshContainer" class="mui-content mui-scroll-wrapper">
        <div class="mui-scroll">
            <div class="banner"><img src="/home/images/banner/1.png" alt=""></div>
            <div id="tab" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
                <a class="mui-control-item" href="javascript:;" data-index="0">
                    <span>手机党校</span>
                </a>
                <a class="mui-control-item" href="javascript:;" data-index="1">
                    <span>练练身手</span>
                </a>
                <a class="mui-control-item" href="javascript:;" data-index="2">
                    <span>党员先锋</span>
                </a>
            </div>
            <div class="mui-slider-item mui-control-content lists1">
                <!-- 手机党校循环体-->
                <a href="/home/learn/detail.html" class="list lesson">
                    <div class="tab">图文</div>
                    <img src="/home/images/banner/2.png" alt="图片" class="img">
                    <div class="title limit">这里是标题区域</div>
                    <span class="study">100人阅读过</span>
                </a>
                <!-- 手机党校循环体-->
                <a href="/home/learn/detail.html" class="list lesson">
                    <div class="tab">图文</div>
                    <img src="/home/images/banner/2.png" alt="图片" class="img">
                    <div class="title limit">这里是标题区域</div>
                    <span class="study">100人阅读过</span>
                </a>
                <!-- 手机党校循环体-->
                <a href="/home/learn/detail.html" class="list lesson">
                    <div class="tab">图文</div>
                    <img src="/home/images/banner/2.png" alt="图片" class="img">
                    <div class="title limit">这里是标题区域</div>
                    <span class="study">100人阅读过</span>
                </a>
                <!-- 手机党校循环体-->
                <a href="/home/learn/detail.html" class="list lesson">
                    <div class="tab">图文</div>
                    <img src="/home/images/banner/2.png" alt="图片" class="img">
                    <div class="title limit">这里是标题区域</div>
                    <span class="study">100人阅读过</span>
                </a>
                <!-- 手机党校循环体-->
                <a href="/home/learn/detail.html" class="list lesson">
                    <div class="tab">图文</div>
                    <img src="/home/images/banner/2.png" alt="图片" class="img">
                    <div class="title limit">这里是标题区域</div>
                    <span class="study">100人阅读过</span>
                </a>

            </div>
            <div class="mui-slider-item mui-control-content lists2">
                <!--选择题循环-->
                <div class="list" data-id="1">
                    <div class="question">
                        <span class="type"><span></span></span>
                        禁止党员领导干部脱离实际，弄虚作假，损害群众利益和党群干群关系。不准（）。
                    </div>
                    <span class="option_">
                        <input type="radio" name="s1" value="1">
                        <span class="option">A.</span>
                        <span class="opt">搞”形象工程“和”政绩工程“</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s1" value="2">
                        <span class="option">B.</span>
                        <span class="opt">虚报工作业绩</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s1" value="3">
                        <span class="option">C.</span>
                        <span class="opt">大办婚丧喜庆事宜</span>
                    </span>
                    <div class="sum fr"><span class="num">1</span>/5</div>
                </div>
                <!--选择题循环-->
                <div class="list" data-id="2">
                    <div class="question">
                        <span class="type"><span></span></span>
                        禁止党员领导干部脱离实际，弄虚作假，损害群众利益和党群干群关系。不准（）。
                    </div>
                    <span class="option_">
                        <input type="radio" name="s2" value="1">
                        <span class="option">A.</span>
                        <span class="opt">搞”形象工程“和”政绩工程“</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s2" value="2">
                        <span class="option">B.</span>
                        <span class="opt">虚报工作业绩</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s2" value="3">
                        <span class="option">C.</span>
                        <span class="opt">大办婚丧喜庆事宜</span>
                    </span>
                    <div class="sum fr"><span class="num">2</span>/5</div>
                </div>
                <!--选择题循环-->
                <div class="list" data-id="3">
                    <div class="question">
                        <span class="type"><span></span></span>
                        禁止党员领导干部脱离实际，弄虚作假，损害群众利益和党群干群关系。不准（）。
                    </div>
                    <span class="option_">
                        <input type="radio" name="s3" value="1">
                        <span class="option">A.</span>
                        <span class="opt">搞”形象工程“和”政绩工程“</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s3" value="2">
                        <span class="option">B.</span>
                        <span class="opt">虚报工作业绩</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s3" value="3">
                        <span class="option">C.</span>
                        <span class="opt">大办婚丧喜庆事宜</span>
                    </span>
                    <div class="sum fr"><span class="num">3</span>/5</div>
                </div>
                <!--选择题循环-->
                <div class="list" data-id="4">
                    <div class="question">
                        <span class="type"><span></span></span>
                        禁止党员领导干部脱离实际，弄虚作假，损害群众利益和党群干群关系。不准（）。
                    </div>
                    <span class="option_">
                        <input type="radio" name="s4" value="1">
                        <span class="option">A.</span>
                        <span class="opt">搞”形象工程“和”政绩工程“</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s4" value="2">
                        <span class="option">B.</span>
                        <span class="opt">虚报工作业绩</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s4" value="3">
                        <span class="option">C.</span>
                        <span class="opt">大办婚丧喜庆事宜</span>
                    </span>
                    <div class="sum fr"><span class="num">4</span>/5</div>
                </div>
                <!--选择题循环-->
                <div class="list" data-id="5">
                    <div class="question">
                        <span class="type"><span></span></span>
                        禁止党员领导干部脱离实际，弄虚作假，损害群众利益和党群干群关系。不准（）。
                    </div>
                    <span class="option_">
                        <input type="radio" name="s5" value="1">
                        <span class="option">A.</span>
                        <span class="opt">搞”形象工程“和”政绩工程“</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s5" value="2">
                        <span class="option">B.</span>
                        <span class="opt">虚报工作业绩</span>
                    </span>
                    <span class="option_">
                        <input type="radio" name="s5" value="3">
                        <span class="option">C.</span>
                        <span class="opt">大办婚丧喜庆事宜</span>
                    </span>
                    <div class="sum fr"><span class="num">5</span>/5</div>
                </div>
                <div class="btn">提交</div>
            </div>
            <div class="mui-slider-item mui-control-content lists3">
                <!-- 党员先锋列表-->
                <a href="/home/learn/leadDetail.html" class="list clearfix">
                    <div class="fl img"><img src="/home/images/common/party.png" alt=""></div>
                    <div class="fl content">
                        <div class="name">
                            张三 <span class="sex">男</span>
                        </div>
                        <div class="professional">
                            <span class="fl">公安局局长</span>
                            <span class="fr"><i class="fa fa-angle-right" aria-hidden="true"></i></span>
                        </div>
                    </div>
                </a>
                <a href="/home/learn/leadDetail.html" class="list clearfix">
                    <div class="fl img"><img src="/home/images/common/party.png" alt=""></div>
                    <div class="fl content">
                        <div class="name">
                            张三 <span class="sex">男</span>
                        </div>
                        <div class="professional">
                            <span class="fl">公安局局长</span>
                            <span class="fr"><i class="fa fa-angle-right" aria-hidden="true"></i></span>
                        </div>
                    </div>
                </a>
                <a href="/home/learn/leadDetail.html" class="list clearfix">
                    <div class="fl img"><img src="/home/images/common/party.png" alt=""></div>
                    <div class="fl content">
                        <div class="name">
                            张三 <span class="sex">男</span>
                        </div>
                        <div class="professional">
                            <span class="fl">公安局局长</span>
                            <span class="fr"><i class="fa fa-angle-right" aria-hidden="true"></i></span>
                        </div>
                    </div>
                </a>
                <a href="/home/learn/leadDetail.html" class="list clearfix">
                    <div class="fl img"><img src="/home/images/common/party.png" alt=""></div>
                    <div class="fl content">
                        <div class="name">
                            张三 <span class="sex">男</span>
                        </div>
                        <div class="professional">
                            <span class="fl">公安局局长</span>
                            <span class="fr"><i class="fa fa-angle-right" aria-hidden="true"></i></span>
                        </div>
                    </div>
                </a>
                <a href="/home/learn/leadDetail.html" class="list clearfix">
                    <div class="fl img"><img src="/home/images/common/party.png" alt=""></div>
                    <div class="fl content">
                        <div class="name">
                            张三 <span class="sex">男</span>
                        </div>
                        <div class="professional">
                            <span class="fl">公安局局长</span>
                            <span class="fr"><i class="fa fa-angle-right" aria-hidden="true"></i></span>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="suc">
    <div class="timer"></div>
    <div class="up">上传中...</div>
</div>

{/block}

{block name="script"}
<script src="/home/js/reset.js"></script>
<script>
    $(function(){
        $("title").text("两学一做");
        // 初始化显示
        c = getCookie("c")?getCookie("c"):0;
        $("#tab a").eq(c).addClass('mui-active');
        $(".mui-slider-group>div").eq(c).addClass('mui-active');
        $(".mui-control-content").eq(c).show().siblings(".mui-control-content").hide();
        $("#tab1 a").eq(c).addClass("mui-active");
    });

    // 首页加载是否需要上拉加载
    window.onload = function() {
        if(c == 0){
            if ($(".lists .lesson").length < 7) {
                mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
            } else {
                mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
            }
        }else if(c == 1) {
            mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
        }else if(c == 2){
            mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
        }
    };

    // tab点击事件
    mui('#tab,#tab1').on('tap', 'a', function(e) {
        mui('#refreshContainer').pullRefresh().scrollTo(0,0);
        mui('#refreshContainer').scroll().scrollTo(0,0);
        mui('#refreshContainer').pullRefresh().refresh(true);
        c = this.getAttribute("data-index");
        $(".mui-control-content").eq(c).show().siblings(".mui-control-content").hide();
        $("#tab a").eq(c).addClass("mui-active").siblings("#tab a").removeClass("mui-active");
        $("#tab1 a").eq(c).addClass("mui-active").siblings("#tab1 a").removeClass("mui-active");
        if(c == 0){
            if($(".lists1 a").length < 6){
                mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
            }else{
                mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
            }
        }else if(c == 1){
            mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
        }else {
            mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
        }
        setCookie("c",c)
    });

    // 滑动时切换tab
    var scroll = mui('.mui-scroll-wrapper').scroll();
    document.querySelector('.mui-scroll-wrapper' ).addEventListener('scroll', function (e ) {
        if (scroll.y <= -Math.ceil(($("body").width() / 2))) {
            $("#tab").hide();
            $("#tab1").show();
            $("#refreshContainer").css("marginTop","13.7vw");
        }else {
            $("#tab").show();
            $("#tab1").hide();
            $("#refreshContainer").css("marginTop","0");
        }
    });

    // 初始化下拉加载
    mui.init({
        pullRefresh: {
            container: '#refreshContainer',
            up: {
                callback: loadScroll
            }
        }
    });

    function loadScroll(){
        var len = $(".lists1 .list").length;
        $.ajax({
            type:"post",
            url:"{:Url('Learn/more')}",
            data:{
                length:len,
                type:1
            },
            beforeSend: function(XMLHttpRequest){
            },
            success:function(data){
                addCourse(data);
                if(data.code == 1){
                    var dataLen =data.data.length;
                    if(data.data.length == 7){
                        mui('#refreshContainer').pullRefresh().endPullupToRefresh(false);
                    }else{
                        mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
                    }
                }else{
                    mui('#refreshContainer').pullRefresh().endPullupToRefresh(true);
                }
            }
        })
    }

    function addCourse(data){
        var html = '';
        var lists = data.data;
        var len = lists.length;
        for(var i = 0; i< len;i++){
            var list = lists[i];
            html+=
                    '<a href="/home/learn/detail/id/'+list.id+'.html" class="list">'+
                    '<div class="tab">图文</div>'+
                    '<img src="'+list.front_cover+'" alt="图片" class="img">'+
                    '<div class="title limit">'+ list.title+'</div>'+
                    '<span class="study">'+ list.views+'人阅读过</span>'+
                    '</a>';
        }
        $(".lists1" ).append(html);
    }

    mui("#refreshContainer").on("touchstart","a",function(){
        $(this).css("backgroundColor","rgba(0,0,0,.1)");
    }).on("touchend","a", function () {
        $(this).css("backgroundColor","#fff");
    });

    mui("#refreshContainer").on("tap","a",function(){
        var url = this.getAttribute("href");
        window.location.href = url;
    });

    // 答题选中
    $(".lists2 .list").on("tap",".option_", function () {
        $(this).addClass("active").siblings(".option_").removeClass("active");
//        $(this).children("input").attr("checked",true).parent(".option_").siblings(".option_").children("input").removeAttr("checked");
    });
    // 答案获取
    function getAn() {
        var arr = [];
        for (var i = 0; i < $(".lists2 .list").length; i++) {
            var t = $(".lists2 .list").eq(i).find(".option_.active");
            var len_t = t.length;
            if (len_t == 0) {
                arr.push(0);
            }else if (len_t == 1) {
                arr.push(t.children("input").val());
            }
        }
        return arr;
    }
    // 答题序号获取
    function anId() {
        var anId = [];
        for (var i = 0; i < $(".lists2 .list").length; i++) {
            anId.push($(".lists2 .list").eq(i).attr("data-id"));
        }
        return anId;
    }
    // 答案提交
    $(".lists2 .btn").on("tap", function () {
        var arr1 = getAn();
        var suc = $(".suc");
        for (var i = 0; i < arr1.length; i++) {
            if (arr1[i] == 0) {
                swal({
                    title: "",
                    text: "答题未完成！",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "确定",
                    cancelButtonText: "取消"
                },function(isConfirm){
                    $.ajax({
                        type: "post",
                        url: '',
                        data: {arr: arr1,id: anId()},
                        success: function (data) {
                            suc.show();
                            setTimeout(function () {
                                window.location.href = "/home/learn/answer.html";
                            },1500)
                        }
                    })
                })
            }else {
                swal({
                    title: "",
                    text: "答题完成！",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    cancelButtonText: "取消"
                },function()
                {
                    $.ajax({
                        type: "post",
                        url: '',
                        data: {arr: arr1,id: anId()},
                        success: function (data) {
                            suc.show();
                            setTimeout(function () {
                                window.location.href = "/home/learn/answer.html";
                            },1500)
                        }
                    })
                })
            }
        }
    })
</script>
{/block}